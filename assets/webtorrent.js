var prev,client=new WebTorrent;function magnetPlay(e){prev&&client.remove(prev),e=e||document.querySelector("#url").value;let t=client.get(e);t?(prev=t.magnetURI,console.log("existing",t),playVid(t)):client.add(e,(function(e){prev=e.magnetURI,playVid(e)}))}function playVid(e){let t=e.files.find((function(e){return e.name.endsWith(".mp4")?e.name.endsWith(".mp4"):e.name.endsWith(".webm")}));t?t.renderTo(mainVid,{controls:!1}):console.log("File type not supported"),fileInput.removeAttribute("disabled"),document.querySelector("#torrentURIPlay").removeAttribute("disabled")}function handlePlay(){mainVid.seeking||socket.emit("requestPlay",{room:room,tStamp:mainVid.currentTime})}function handlePause(){mainVid.seeking||socket.emit("requestPause",{room:room,tStamp:mainVid.currentTime})}function exit(){window.location.pathname="/"}client.on("torrent",(e=>{console.log("ready to play torrent "),socket.emit("readyToPlay",{room:room})})),client.on("error",(e=>{console.log("error occcured on",e)})),document.querySelector("#torrentURIPlay").addEventListener("click",(e=>magnetPlay())),fileInput.addEventListener("change",(function(e){let t=e.target.files[0];t&&(mainVid.pause(),fileInput.setAttribute("disabled","on"),document.querySelector("#torrentURIPlay").setAttribute("disabled","on"),client.seed(t,(e=>{magnetPlay(e.magnetURI),socket.emit("requestURIUpdate",{room:room,uri:e.magnetURI})})))})),mainVid.addEventListener("play",handlePlay),mainVid.addEventListener("pause",handlePause);